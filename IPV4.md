# IPV4协议

## 首部格式

```shell
<4bit版本号><4bit首部长度><8bit区分服务><16bit总长度>
<16bit标识><4bit标志><12bit片偏移>
<8bit生存时间><8bit上层协议><16bit校验和>
<32bit源地址>
<32bit目的地址>
<0~40Byte选项>
```

### 版本号

IP协议的版本号4.

### 首部长度

单位为4Byte.

### 区分服务

在现在的以太网中已经被淘汰.

### 总长度

单位为1Byte.

### 标识

信源机产生的每个数据报的唯一标识符, 标识同一数据报的不同分片.

### 标志

目前只有后两位DF位和MF位有效, DF位等于一时表示强制不允许分片, MF位等于一时表示不是最后一片.

### 片偏移

数据段距首位的偏移量, 单位为8Byte, 标识分片在原来数据报中的位置.

### 生存时间

TTL(Time To Live), 可通过路由器数的最大值, 每经过一个路由器便减一, 若为零丢弃该数据包, 便发送ICMP报文通知源主机.

### 上层协议

运输层协议, eg: TCP, UDP.

### 校验和

因为每经过一个路由器, IP报文首部便会跟着变化一次, 数据部分并不改变, 只校验数据报的首部, 分成多个16bit字段, 进行二进制反码加法运算, 结果取反, 得到校验和.

### 选项

主要用于控制和测试, 可选字段.

